#前回の復習#線形回帰モデルを走らせるsetwd("~/dev/feg/day09/20131206_data")tea <- read.csv(file = "tea.csv")View(tea)str(tea)summary(tea)plot(tea$temperature, tea$tea)cor(tea$temperature, tea$tea)lm01 <- lm(tea ~ temperature, data = tea)summary(lm01)#推定結果を図示plot(tea$temperature, tea$tea)abline(lm01, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定#Anscombeのデータsetwd("C:/Users/sugawara/Documents/32prj1309MUIT")a01 <- read.csv(file = "Anscombe.csv")str(a01)View(a01)#平均値の一致についてmean(a01$x1)mean(a01$x2)mean(a01$x3)mean(a01$x4)# [1] 9mean(a01$y1)mean(a01$y2)mean(a01$y3)mean(a01$y4)# [1] 7.5#相関係数の一致についてcor(a01$x1, a01$y1)cor(a01$x2, a01$y2)cor(a01$x3, a01$y3)cor(a01$x4, a01$y4)# [1] 0.816lm01 <- lm(a01$y1 ~ a01$x1, data = a01)lm02 <- lm(a01$y2 ~ a01$x2, data = a01)lm03 <- lm(a01$y3 ~ a01$x3, data = a01)lm04 <- lm(a01$y4 ~ a01$x4, data = a01)#回帰係数のの一致についてlm01$coefficientslm02$coefficientslm03$coefficientslm04$coefficients# (Intercept)      a01$x1 #        3.00       0.500#ネタバレ 4つの回帰直線をグラフ化してみようpar(mfrow = c(2, 2))plot(a01$x1, a01$y1)abline(lm01, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定plot(a01$x2, a01$y2)abline(lm02, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定plot(a01$x3, a01$y3)abline(lm03, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定plot(a01$x4, a01$y4)abline(lm04, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定#x3とy3の改善案print(a01[, c("x3", "y3")])a01[3, c("x3", "y3")]#外れ値を除くb01 <- a01[-3, ] b01lm03a <- lm(b01$y3 ~ b01$x3, data = b01)summary(lm03)summary(lm03a)lm03$coefficients# (Intercept)      a01$x3 # 3.0024545   0.4997273 lm03a$coefficients# (Intercept)      b01$x3 # 4.0056494   0.3453896 plot(b01$x3, b01$y3)abline(lm03a, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "blue") #線の色の指定plot(a01$x3, a01$y3, ylim = c(5, 13))abline(lm03a, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "blue") #線の色の指定abline(lm03, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定#x4とy4の改善案print(a01[, c("x4", "y4")])a01[8, c("x4", "y4")]#外れ値を除くc01 <- a01[-8, ] c01[, c("x4", "y4")]lm04a <- lm(c01$y4 ~ c01$x4, data = c01)summary(lm04)summary(lm04a)lm04$coefficients# (Intercept)      a01$x4 # 3.0017273   0.4999091lm04a$coefficients# (Intercept)      c01$x4 # 7.001          NAplot(c01$x4, c01$y4)abline(v = 8, #垂線       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "blue") #線の色の指定plot(a01$x4, a01$y4)abline(v = 8, #垂線       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "blue") #線の色の指定abline(lm04, #線形回帰モデル       lwd = 1, #線の太さの指定（小さいほど細い）       lty = 1, #線のタイプの指定（実線）       col = "red") #線の色の指定#重回帰モデルlibrary(car)?Duncandata(Duncan)str(Duncan)# 'data.frame':  45 obs. of  4 variables:# $ type     : Factor w/ 3 levels "bc","prof","wc": 2 2 2 2 2 2 2 2 3 2 ...# $ income   : int  62 72 75 55 64 21 64 80 67 72 ...# $ education: int  86 76 92 90 86 84 93 100 87 86 ...# $ prestige : int  82 83 90 76 90 87 93 90 52 88 ...View(Duncan)summary(Duncan)# type        income        education         prestige    # bc  :21   Min.   : 7.00   Min.   :  7.00   Min.   : 3.00  # prof:18   1st Qu.:21.00   1st Qu.: 26.00   1st Qu.:16.00  # wc  : 6   Median :42.00   Median : 45.00   Median :41.00  #           Mean   :41.87   Mean   : 52.56   Mean   :47.69  #           3rd Qu.:64.00   3rd Qu.: 84.00   3rd Qu.:81.00  #           Max.   :81.00   Max.   :100.00   Max.   :97.00 cor(Duncan[,-1])#             income education  prestige# income    1.0000000 0.7245124 0.8378014# education 0.7245124 1.0000000 0.8519156# prestige  0.8378014 0.8519156 1.0000000#文字×数値#type別incomeの分布aggregate(Duncan$income, list(Duncan$type), summary)#箱ひげ図で表示boxplot(Duncan$income)boxplot(Duncan$income ~ Duncan$type)plot(Duncan)plot(Duncan[2:4], pch = 21, cex = 2,     bg = c(2, 3, 4)[unclass(Duncan$type)])title(sub = "赤：bc, 青：wc, 黄緑：prof") #グラフの下にタイトル#数値変数のみ使った回帰モデルmlm01 <- lm(income ~ education,            data = Duncan)summary(mlm01)mlm02 <- lm(income ~ prestige,            data = Duncan)summary(mlm02)#文字変数をモデルに投入する#0/1のダミー変数の作り方#分布から、ブルーカラーを0, ホワイトカラーと専門職を1とするDuncan2 <- transform(Duncan,                   type2 = ifelse(type == "bc", 0, 1))#加工変数type2の確認  table(Duncan2$type2, Duncan2$type)  # bc prof wc  # 0 21    0  0  # 1  0   18  6mlm03 <- lm(income ~ education + type2,            data = Duncan2)summary(mlm03)# Coefficients:#               Estimate Std. Error t value Pr(>|t|)  # (Intercept)    13.9924     5.6643   2.470   0.0176 *#   education     0.3856     0.1702   2.266   0.0286 *#   type2        14.2628    10.0375   1.421   0.1627  mlm04 <- lm(income ~ prestige + type2,            data = Duncan2)summary(mlm04)# Coefficients:#   Estimate Std. Error t value Pr(>|t|)    # (Intercept) 11.19393    3.65032   3.067  0.00378 ** #   prestige     0.55215    0.09641   5.727 9.81e-07 ***#   type2        8.14002    6.02162   1.352  0.18368    mlm05 <- lm(income ~ education + prestige + type2,            data = Duncan2)summary(mlm05)# Coefficients:#             Estimate Std. Error t value Pr(>|t|)    # (Intercept)  13.4109     4.5139   2.971  0.00495 ** # education    -0.1445     0.1719  -0.841  0.40548    # prestige      0.6155     0.1227   5.018 1.06e-05 ***# type2        12.5511     8.0035   1.568  0.12452  #回帰係数mlm03$coefficients# (Intercept)   education       type2 # 13.9923780   0.3856392  14.2627603 #回帰係数の検算S11 <-  sum((Duncan2$education - mean(Duncan2$education)) ** 2)S22 <-  sum((Duncan2$type2 - mean(Duncan2$type2)) ** 2)S12 <-  sum(Duncan2$education * Duncan2$type2) - nrow(Duncan2) * mean(Duncan2$education) * mean(Duncan2$type2)S1y <-  sum(Duncan2$education * Duncan2$income) - nrow(Duncan2) * mean(Duncan2$education) * mean(Duncan2$income)S2y <-  sum(Duncan2$type2 * Duncan2$income) - nrow(Duncan2) * mean(Duncan2$type2) * mean(Duncan2$income)beta1 <- (S1y * S22 - S12 * S2y) / (S11 * S22 - S12 ** 2)beta2 <- (S2y * S11 - S12 * S1y) / (S11 * S22 - S12 ** 2)beta1# [1] 0.3856392beta2# [1] 14.26276alpha <- mean(Duncan2$income) - beta1 * mean(Duncan2$education) - beta2 * mean(Duncan2$type2)alpha# [1] 13.99238#決定係数mlm05 <- lm(income ~ education + prestige + type2,            data = Duncan2)summary(mlm05)# Multiple R-squared:  0.7192,  Adjusted R-squared:  0.6986 round(  cor(Duncan2$income, mlm05$fitted.values) ** 2  , 4)# [1] 0.7192R2 <- cor(Duncan2$income, mlm05$fitted.values) ** 21 - (1 - R2)  * ((nrow(Duncan2) - 1 ) / (nrow(Duncan2) - (length(mlm05$coefficients) )) ) 1 - ((1 - R2)) * (44/41)# [1] 0.6986311#Variance Inflation Factor#VIF1 = 1 /(1 - r12^2)vif(lm(income ~ prestige + education, data = Duncan))# prestige education # 3.646444  3.646444 cor(Duncan$prestige, Duncan$education)# [1] 0.85191561 / (1 - cor(Duncan$prestige, Duncan$education) ** 2)# [1] 3.646444?mtcarssummary(mtcars)# mpg             cyl             disp             hp             drat      # Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0   Min.   :2.760  # 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5   1st Qu.:3.080  # Median :19.20   Median :6.000   Median :196.3   Median :123.0   Median :3.695  # Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7   Mean   :3.597  # 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0   3rd Qu.:3.920  # Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0   Max.   :4.930  # wt             qsec             vs               am              gear      # Min.   :1.513   Min.   :14.50   Min.   :0.0000   Min.   :0.0000   Min.   :3.000  # 1st Qu.:2.581   1st Qu.:16.89   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:3.000  # Median :3.325   Median :17.71   Median :0.0000   Median :0.0000   Median :4.000  # Mean   :3.217   Mean   :17.85   Mean   :0.4375   Mean   :0.4062   Mean   :3.688  # 3rd Qu.:3.610   3rd Qu.:18.90   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:4.000  # Max.   :5.424   Max.   :22.90   Max.   :1.0000   Max.   :1.0000   Max.   :5.000  # carb      # Min.   :1.000  # 1st Qu.:2.000  # Median :2.000  # Mean   :2.812  # 3rd Qu.:4.000  # Max.   :8.000  str(mtcars)# 'data.frame':  32 obs. of  11 variables:# $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...# $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...# $ disp: num  160 160 108 258 360 ...# $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...# $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...# $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...# $ qsec: num  16.5 17 18.6 19.4 17 ...# $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...# $ am  : num  1 1 1 0 0 0 0 0 0 0 ...# $ gear: num  4 4 4 3 3 3 3 4 4 4 ...# $ carb: num  4 4 1 1 2 1 4 2 2 4 ...plot(mtcars[1:5])plot(mtcars[c(1, 6:10)])cor(mtcars)cor(mtcars[1:5])cor(mtcars[c(1, 6:10)])mlm01 <- lm(mpg ~ disp + wt,            data = mtcars)summary(mlm01)#変数選択★